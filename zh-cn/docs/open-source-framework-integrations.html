<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163094446-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-163094446-1');
	</script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="open-source-framework-integrations" />
	<meta name="description" content="open-source-framework-integrations" />
	<!-- 网页标签标题 -->
	<title>open-source-framework-integrations</title>
	<link rel="shortcut icon" href="/img/sentinel.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/sentinel_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><span><a href="/zh-cn/index.html">首页</a></span></li><li class="menu-item menu-item-normal menu-item-normal-active"><span><a href="/zh-cn/docs/introduction.html">文档</a></span></li><li class="menu-item menu-item-normal"><div class="nav-container"><div class="word"><a>解决方案</a><img class="menu-img" src="https://img.alicdn.com/tfs/TB1esl_m.T1gK0jSZFrXXcNCXXa-200-200.png"/></div><ul class="sub-nav-container" style="width:220px"><li><a href="https://www.aliyun.com/product/aliware/mse?sentinel-website.topbar.0.0.0" target="_blank">微服务解决方案</a></li><li><a href="https://www.aliyun.com/product/ahas?spm=sentinel-website.topbar.0.0.0" target="_blank">高可用解决方案</a></li><li><a href="https://www.aliyun.com/aliware/txc?sentinel-website.topbar.0.0.0" target="_blank">分布式事务解决方案</a></li><li><a href="https://cn.aliyun.com/product/aliware/sae?sentinel-website.topbar.0.0.0" target="_blank">微服务Serverless解决方案</a></li><li><a href="https://www.aliyun.com/product/edas?sentinel-website.topbar.0.0.0" target="_blank">APaaS解决方案</a></li><li><a href="https://www.aliyun.com/product/servicemesh?sentinel-website.topbar.0.0.0" target="_blank">服务网格解决方案</a></li></ul> </div></li><li class="menu-item menu-item-normal"><span><a href="/zh-cn/docs/developers/developers_dev.html">开发者</a></span></li><li class="menu-item menu-item-normal"><span><a href="/zh-cn/blog/index.html">博客</a></span></li><li class="menu-item menu-item-normal"><span><a href="/zh-cn/community/index.html">社区</a></span></li><li class="menu-item menu-item-normal"><span><a href="https://developer.aliyun.com/ebook/7565?spm=sentinel-website.topbar.0.0.0">服务治理白皮书</a><img class="menu-img" src="https://img.alicdn.com/tfs/TB1esl_m.T1gK0jSZFrXXcNCXXa-200-200.png"/></span></li><li class="menu-item menu-item-normal"><span><a href="https://www.aliyun.com/product/aliware/mse?sentinel-website.topbar.0.0.0">企业版 Sentinel</a><img class="menu-img" src="https://img.alicdn.com/tfs/TB1esl_m.T1gK0jSZFrXXcNCXXa-200-200.png"/></span></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>用户文档</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/introduction.html" target="_self">Sentinel 介绍</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>入门参考<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/quick-start.html" target="_self">快速开始</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/basic-implementation.html" target="_self">基本原理</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>使用文档<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/basic-api-resource-rule.html" target="_self">基本使用（资源与规则）</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/flow-control.html" target="_self">流量控制</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/circuit-breaking.html" target="_self">熔断降级</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/system-adaptive-protection.html" target="_self">系统自适应保护</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/cluster-flow-control.html" target="_self">集群流量控制</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/api-gateway-flow-control.html" target="_self">网关流量控制</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/parameter-flow-control.html" target="_self">热点参数限流</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/origin-authority-control.html" target="_self">来源访问控制</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/annotation-support.html" target="_self">注解支持</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/dynamic-rule-configuration.html" target="_self">动态规则扩展</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/opensergo-data-source.html" target="_self">OpenSergo 流量治理</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/logs.html" target="_self">日志</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/metrics.html" target="_self">实时监控</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/general-configuration.html" target="_self">启动配置项</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/dashboard.html" target="_self">Sentinel 控制台</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/open-source-framework-integrations.html" target="_self">开源框架适配</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/polyglot-support.html" target="_self">多语言支持</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/faq.html" target="_self">FAQ</a></li></ul></li><li class="menu-item menu-item-level-1"><span>多语言文档</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Sentinel Go<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/quick-start.html" target="_self">快速开始</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/basic-api-usage.html" target="_self">基本 API 使用指南</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/flow-control.html" target="_self">流量控制</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/circuit-breaking.html" target="_self">熔断降级</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/concurrency-limiting-isolation.html" target="_self">并发隔离控制</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/system-adaptive-protection.html" target="_self">系统自适应保护</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/hotspot-param-flow-control.html" target="_self">热点参数流控</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/open-source-framework-integrations.html" target="_self">开源框架适配</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/dynamic-data-source-usage.html" target="_self">动态规则扩展</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/general-configuration.html" target="_self">通用配置</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/golang/logging.html" target="_self">日志</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>贡献手册</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/contribution/contribution-guideline.html" target="_self">开源贡献指南</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>开源框架适配</h1>
<ul>
<li>云原生微服务体系
<ul>
<li>Spring Boot/Spring Cloud</li>
<li>Quarkus</li>
</ul>
</li>
<li>Web 适配
<ul>
<li>Web Servlet</li>
<li>Spring Web</li>
<li>Spring WebFlux</li>
<li>JAX-RS (Java EE)</li>
</ul>
</li>
<li>RPC 适配
<ul>
<li>Apache Dubbo</li>
<li>gRPC</li>
<li>Feign</li>
<li>SOFARPC</li>
</ul>
</li>
<li>HTTP client 适配
<ul>
<li>Apache HttpClient</li>
<li>OkHttp</li>
</ul>
</li>
<li>Reactive 适配
<ul>
<li>Reactor</li>
</ul>
</li>
<li>API Gateway 适配
<ul>
<li>Spring Cloud Gateway</li>
<li>Netflix Zuul 1.x</li>
<li>Netflix Zuul 2.x</li>
</ul>
</li>
<li>Apache RocketMQ</li>
</ul>
<blockquote>
<p><strong>注：适配模块仅提供相应适配功能，若希望接入 Sentinel 控制台，请务必参考 <a href="./dashboard.md">Sentinel 控制台文档</a>。</strong></p>
</blockquote>
<h2>云原生微服务体系</h2>
<h3>Spring Cloud</h3>
<p><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba">Spring Cloud Alibaba</a> 致力于提供微服务开发的一站式解决方案。Sentinel 与 Spring Boot/Spring Cloud 的整合见 <a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel">Sentinel Spring Cloud Starter</a>。</p>
<p>Spring Cloud Alibaba 默认为 Sentinel 整合了 Servlet、RestTemplate、FeignClient 和 Spring WebFlux。Sentinel 在 Spring Cloud 生态中，不仅补全了 Hystrix 在 Servlet 和 RestTemplate 这一块的空白，而且还完全兼容了 Hystrix 在 FeignClient 中限流降级的用法，并且支持运行时灵活地配置和调整限流降级规则。</p>
<p>Spring Cloud Alibaba Sentinel 的示例可以参考 <a href="https://github.com/sentinel-group/sentinel-guides/tree/master/sentinel-guide-spring-cloud">sentinel-guide-spring-cloud</a></p>
<h3>Quarkus</h3>
<blockquote>
<p>注：从 1.8.0 版本开始支持，需要 Java 8 及以上版本。</p>
</blockquote>
<p>Sentinel 提供<a href="https://github.com/alibaba/Sentinel/tree/master/sentinel-adapter/sentinel-quarkus-adapter">针对 Quarkus 微服务的适配模块</a>（支持 native image），可以很方便地将 JAX-RS Web 服务接入并进行高可用防护，同时支持注解方式自定义埋点（基于 CDI）。</p>
<p>相关模块：</p>
<ul>
<li><code>sentinel-jax-rs-quarkus-adapter</code></li>
<li><code>sentinel-annotation-quarkus-adapter</code></li>
</ul>
<h2>Web 适配</h2>
<h3>Web Servlet</h3>
<p>Sentinel 提供针对 Servlet 的原生整合，可以对 Web 请求进行流量控制。使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-web-servlet<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>您只需要在 Web 容器中的 <code>web.xml</code> 配置文件中进行如下配置即可开启 Sentinel 支持：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>SentinelCommonFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>com.alibaba.csp.sentinel.adapter.servlet.CommonFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>SentinelCommonFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span>
</code></pre>
<p>若是 Spring 应用可以通过 Spring 进行配置，例如：</p>
<pre><code class="language-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FilterConfig</span> </span>{

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">sentinelFilterRegistration</span><span class="hljs-params">()</span> </span>{
        FilterRegistrationBean&lt;Filter&gt; registration = <span class="hljs-keyword">new</span> FilterRegistrationBean&lt;&gt;();
        registration.setFilter(<span class="hljs-keyword">new</span> CommonFilter());
        registration.addUrlPatterns(<span class="hljs-string">"/*"</span>);
        registration.setName(<span class="hljs-string">"sentinelFilter"</span>);
        registration.setOrder(<span class="hljs-number">1</span>);

        <span class="hljs-keyword">return</span> registration;
    }
}
</code></pre>
<p>接入 filter 之后，所有访问的 Web URL 就会被自动统计为 Sentinel 的资源，可以针对单个 URL 维度进行流控。若希望区分不同 HTTP Method，可以将 <code>HTTP_METHOD_SPECIFY</code> 这个 init parameter 设为 true，给每个 URL 资源加上前缀，比如 <code>GET:/foo</code>。</p>
<p><strong>限流处理逻辑</strong>：默认情况下，当请求被限流时会返回默认的提示页面 <code>Blocked by Sentinel (flow limiting)</code>。您也可以通过 JVM 参数 <code>-Dcsp.sentinel.web.servlet.block.page</code> 或代码中调用 <code>WebServletConfig.setBlockPage(blockPage)</code> 方法设定自定义的跳转 URL，当请求被限流时会自动跳转至设定好的 URL。同样您也可以实现 <code>UrlBlockHandler</code> 接口并编写定制化的限流处理逻辑，然后将其注册至 <code>WebCallbackManager</code> 中。</p>
<blockquote>
<p>提示：1.7.0 版本开始默认的限流页面 HTTP 返回码是 <strong>429</strong>。您可以通过 <code>csp.sentinel.web.servlet.block.status</code> 配置项自定义限流页面的 HTTP 状态码。</p>
</blockquote>
<p><strong>按来源限流</strong>：若希望对 HTTP 请求按照来源限流，则可以自己实现 <code>RequestOriginParser</code> 接口从 HTTP 请求中解析 origin 并注册至 <code>WebCallbackManager</code> 中。<strong>注意来源数目不能太多，若太多请自定义埋点作为参数传入并使用热点规则。</strong></p>
<p><strong>注意</strong>：Sentinel Web Filter 会将每个到来的不同的 URL 都作为不同的资源处理，因此对于 REST 风格的 API，需要自行实现 <code>UrlCleaner</code> 接口清洗一下资源（比如将满足 <code>/foo/:id</code> 的 URL 都归到 <code>/foo/*</code> 资源下），然后将其注册至 <code>WebCallbackManager</code> 中。否则会导致资源数量过多，超出资源数量阈值（目前是 6000）时多出的资源的规则将 <strong>不会生效</strong>。</p>
<p>从 1.6.3 版本开始，<code>UrlCleaner</code> 还可以来过滤掉不希望统计的 URL，只需要在 UrlCleaner 中将不希望统计的 URL 转换成空字符串（&quot;&quot;）即可。示例：</p>
<pre><code class="language-java">WebCallbackManager.setUrlCleaner(<span class="hljs-keyword">new</span> UrlCleaner() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">clean</span><span class="hljs-params">(String originUrl)</span> </span>{
        <span class="hljs-keyword">if</span> (originUrl == <span class="hljs-keyword">null</span> || originUrl.isEmpty()) {
            <span class="hljs-keyword">return</span> originUrl;
        }

        <span class="hljs-comment">// 比如将满足 /foo/{id} 的 URL 都归到 /foo/*</span>
        <span class="hljs-keyword">if</span> (originUrl.startsWith(<span class="hljs-string">"/foo/"</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"/foo/*"</span>;
        }
        <span class="hljs-comment">// 不希望统计 *.ico 的资源文件，可以将其转换为 empty string (since 1.6.3)</span>
        <span class="hljs-keyword">if</span> (originUrl.endsWith(<span class="hljs-string">".ico"</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
        <span class="hljs-keyword">return</span> originUrl;
    }
});
</code></pre>
<p>如果您正在使用 Spring Boot / Spring Cloud，那么可以通过引入 Spring Cloud Alibaba Sentinel 来更方便地整合 Sentinel，详情请见 <a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-sentinel">Spring Cloud Alibaba 文档</a>。</p>
<h3>Spring WebFlux</h3>
<blockquote>
<p>注：从 1.5.0 版本开始支持，需要 Java 8 及以上版本。</p>
</blockquote>
<p>Sentinel 提供与 Spring WebFlux 的整合模块，从而 Reactive Web 应用也可以利用 Sentinel 的流控降级来保障稳定性。该整合模块基于 Sentinel Reactor Adapter 实现。</p>
<p>使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-spring-webflux-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>使用时只需注入对应的 <code>SentinelWebFluxFilter</code> 实例以及 <code>SentinelBlockExceptionHandler</code> 实例即可。比如：</p>
<pre><code class="language-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebFluxConfig</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;ViewResolver&gt; viewResolvers;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ServerCodecConfigurer serverCodecConfigurer;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WebFluxConfig</span><span class="hljs-params">(ObjectProvider&lt;List&lt;ViewResolver&gt;&gt; viewResolversProvider,
                         ServerCodecConfigurer serverCodecConfigurer)</span> </span>{
        <span class="hljs-keyword">this</span>.viewResolvers = viewResolversProvider.getIfAvailable(Collections::emptyList);
        <span class="hljs-keyword">this</span>.serverCodecConfigurer = serverCodecConfigurer;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Order</span>(-<span class="hljs-number">1</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> SentinelBlockExceptionHandler <span class="hljs-title">sentinelBlockExceptionHandler</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// Register the block exception handler for Spring WebFlux.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SentinelBlockExceptionHandler(viewResolvers, serverCodecConfigurer);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Order</span>(-<span class="hljs-number">1</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> SentinelWebFluxFilter <span class="hljs-title">sentinelWebFluxFilter</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// Register the Sentinel WebFlux filter.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SentinelWebFluxFilter();
    }
}
</code></pre>
<p>您可以在 <code>WebFluxCallbackManager</code> 注册回调进行定制：</p>
<ul>
<li><code>setBlockHandler</code>：注册函数用于实现自定义的逻辑处理被限流的请求，对应接口为 <code>BlockRequestHandler</code>。默认实现为 <code>DefaultBlockRequestHandler</code>，当被限流时会返回类似于下面的错误信息：<code>Blocked by Sentinel: FlowException</code>。</li>
<li><code>setUrlCleaner</code>：注册函数用于 Web 资源名的归一化。函数类型为 <code>(ServerWebExchange, String) → String</code>，对应含义为 <code>(webExchange, originalUrl) → finalUrl</code>。</li>
<li><code>setRequestOriginParser</code>：注册函数用于从请求中解析请求来源。函数类型为 <code>ServerWebExchange → String</code>。</li>
</ul>
<p>相关示例：<a href="https://github.com/alibaba/Sentinel/tree/master/sentinel-demo/sentinel-demo-spring-webflux">sentinel-demo-spring-webflux</a></p>
<h3>JAX-RS (Java EE)</h3>
<blockquote>
<p>注：从 1.8.0 版本开始原生支持。若您的服务是 Spring Web 服务，可参考 Spring Web 适配文档接入。</p>
</blockquote>
<p><a href="https://github.com/alibaba/Sentinel/tree/master/sentinel-adapter/sentinel-jax-rs-adapter">sentinel-jax-rs-adapter</a></p>
<h2>RPC 适配</h2>
<h3>Dubbo</h3>
<p>Sentinel 提供 Dubbo 的相关适配 <a href="https://github.com/dubbo/dubbo-sentinel-support">Sentinel Dubbo Adapter</a>，主要包括针对 Service Provider 和 Service Consumer 实现的 Filter。相关模块：</p>
<ul>
<li><code>sentinel-apache-dubbo3-adapter</code>（兼容 Apache Dubbo 3.0.5 及以上版本，自 Sentinel 1.8.5 开始支持）</li>
<li><code>sentinel-apache-dubbo-adapter</code>（兼容 Apache Dubbo 2.7.x 及以上版本，自 Sentinel 1.5.1 开始支持）</li>
<li><code>sentinel-dubbo-adapter</code>（兼容 Dubbo 2.6.x 版本）</li>
</ul>
<p>对于 Apache Dubbo <strong>3.0.5</strong> 及以上版本，使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-apache-dubbo3-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>对于 Apache Dubbo <strong>2.7.x</strong> 及以上版本，使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-apache-dubbo-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>对于 Dubbo <strong>2.6.x</strong> 及以下版本，使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-dubbo-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>引入此依赖后，Dubbo 的服务接口和方法（包括调用端和服务端）就会成为 Sentinel 中的资源，在配置了规则后就可以自动享受到 Sentinel 的防护能力。</p>
<blockquote>
<p><strong>注：若希望接入 Dashboard，请参考 <a href="https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-dubbo/README.md#sentinel-dashboard">接入控制台的步骤</a>。只引入 Sentinel Dubbo Adapter 无法接入控制台！</strong></p>
</blockquote>
<p>若不希望开启 Sentinel Dubbo Adapter 中的某个 Filter，可以手动关闭对应的 Filter，比如：</p>
<pre><code class="language-xml"><span class="hljs-comment">&lt;!-- 关闭 Sentinel 对应的 Service Consumer Filter --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dubbo:consumer</span> <span class="hljs-attr">filter</span>=<span class="hljs-string">"-sentinel.dubbo.consumer.filter"</span>/&gt;</span>
</code></pre>
<p>限流粒度可以是服务接口和服务方法两种粒度：</p>
<ul>
<li>服务接口：resourceName 为 <code>接口全限定名</code>，如 <code>com.alibaba.csp.sentinel.demo.dubbo.FooService</code></li>
<li>服务方法：resourceName 为 <code>接口全限定名:方法签名</code>，如 <code>com.alibaba.csp.sentinel.demo.dubbo.FooService:sayHello(java.lang.String)</code></li>
</ul>
<p>Sentinel Dubbo Adapter 还支持配置全局的 fallback 函数，可以在 Dubbo 服务被限流/降级/负载保护的时候进行相应的 fallback 处理。用户只需要实现自定义的 <a href="https://github.com/alibaba/Sentinel/blob/master/sentinel-adapter/sentinel-dubbo-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/dubbo/fallback/DubboFallback.java"><code>DubboFallback</code></a> 接口，并通过 <code>DubboFallbackRegistry</code> 注册即可。默认情况会直接将 <code>BlockException</code> 包装后抛出。同时，我们还可以配合 <a href="http://dubbo.incubator.apache.org/zh-cn/docs/user/demos/local-mock.html">Dubbo 的 fallback 机制</a> 来为降级的服务提供替代的实现。</p>
<p>我们提供了 Dubbo 的相关示例，请见 <a href="https://github.com/alibaba/Sentinel/tree/master/sentinel-demo/sentinel-demo-dubbo">sentinel-demo-dubbo</a>。</p>
<p>有关 Sentinel 在 Dubbo 中的最佳实践，请参考 <a href="http://dubbo.incubator.apache.org/zh-cn/blog/sentinel-introduction-for-dubbo.html">Sentinel: Dubbo 服务的流量哨兵</a>。</p>
<p>关于 Dubbo Filter 的更多信息，请参考 <a href="http://dubbo.incubator.apache.org/zh-cn/docs/dev/impls/filter.html">Dubbo Filter 文档</a>。</p>
<h3>gRPC</h3>
<p>Sentinel 提供与 <a href="https://github.com/grpc/grpc-java">gRPC Java</a> 的整合，以 gRPC <a href="https://grpc.io/grpc-java/javadoc/io/grpc/ServerInterceptor.html">ServerInterceptor</a> 和 <a href="https://grpc.io/grpc-java/javadoc/io/grpc/ClientInterceptor.html">ClientInterceptor</a> 的形式保护 gRPC 服务资源。使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-grpc-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>在使用 Sentinel gRPC Adapter 时，只需要将对应的 <code>Interceptor</code> 注册至对应的客户端或服务端中。其中客户端的示例如下：</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServiceClient</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ManagedChannel channel;

    ServiceClient(String host, <span class="hljs-keyword">int</span> port) {
        <span class="hljs-keyword">this</span>.channel = ManagedChannelBuilder.forAddress(host, port)
            .intercept(<span class="hljs-keyword">new</span> SentinelGrpcClientInterceptor()) <span class="hljs-comment">// 在此处注册拦截器</span>
            .build();
        <span class="hljs-comment">// 在此处初始化客户端 stub 类</span>
    }
}
</code></pre>
<p>服务端的示例如下：</p>
<pre><code class="language-java"><span class="hljs-keyword">import</span> io.grpc.Server;

Server server = ServerBuilder.forPort(port)
     .addService(<span class="hljs-keyword">new</span> MyServiceImpl()) <span class="hljs-comment">// 添加自己的服务实现</span>
     .intercept(<span class="hljs-keyword">new</span> SentinelGrpcServerInterceptor()) <span class="hljs-comment">// 在此处注册拦截器</span>
     .build();
</code></pre>
<p>注意：Sentinel gRPC Adapter 目前只支持 unary call。</p>
<h3>Feign</h3>
<p>Feign 适配整合在 Spring Cloud Alibaba 中，可以参考 <a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel">Spring Cloud Alibaba Sentinel 文档</a> 进行接入。</p>
<h3>SOFARPC</h3>
<p>从 1.7.2 版本开始，Sentinel 提供 SOFARPC 的适配模块 <a href="https://github.com/alibaba/Sentinel/tree/master/sentinel-adapter/sentinel-sofa-rpc-adapter">sentinel-sofa-rpc-adapter</a>，主要包括针对 Service Provider 和 Service Consumer 实现的 Filter。使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-sofa-rpc-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>引入此依赖后，Sentinel 会自动统计 SOFARPC 的服务接口和方法调用（包括调用端和服务端），在配置了规则后就可以自动享受到 Sentinel 的防护能力。</p>
<h2>HTTP Client 适配</h2>
<h3>Apache HttpClient</h3>
<blockquote>
<p>注：从 Sentinel 1.8.0 版本开始支持。</p>
</blockquote>
<p>Sentinel 提供 Apache HttpClient 的适配模块 <a href="https://github.com/alibaba/Sentinel/tree/master/sentinel-adapter/sentinel-apache-httpclient-adapter">sentinel-apache-httpclient-adapter</a>，可以针对 HTTP client 请求进行流控和熔断。使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-apache-httpclient-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>注意目前暂不支持 AsyncHttpClient。</p>
<h3>OkHttp</h3>
<blockquote>
<p>注：从 Sentinel 1.8.0 版本开始支持。</p>
</blockquote>
<p>Sentinel 提供 OkHttp 的适配模块 <a href="https://github.com/alibaba/Sentinel/tree/master/sentinel-adapter/sentinel-okhttp-adapter">sentinel-okhttp-adapter</a>，可以针对 HTTP client 请求进行流控和熔断。使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-okhttp-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h2>Reactive 适配</h2>
<h3>Reactor</h3>
<blockquote>
<p>注：从 1.5.0 版本开始支持，需要 Java 8 及以上版本。</p>
</blockquote>
<p>Sentinel 提供 <a href="https://projectreactor.io/">Reactor</a> 的适配，可以方便地在 reactive 应用中接入 Sentinel。使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-reactor-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>Sentinel Reactor Adapter 分别针对 <code>Mono</code> 和 <code>Flux</code> 实现了对应的 Sentinel Operator，从而在各种事件触发时汇入 Sentinel 的相关逻辑。同时 Sentinel 在上层提供了 <code>SentinelReactorTransformer</code> 用于在组装期装入对应的 operator，用户使用时只需要通过 <code>transform</code> 操作符来进行变换即可。接入示例：</p>
<pre><code class="language-java">someService.doSomething() <span class="hljs-comment">// return type: Mono&lt;T&gt; or Flux&lt;T&gt;</span>
   .transform(<span class="hljs-keyword">new</span> SentinelReactorTransformer&lt;&gt;(resourceName)) <span class="hljs-comment">// 在此处进行变换</span>
   .subscribe();
</code></pre>
<h2>API Gateway 适配</h2>
<p>Sentinel 支持对 Spring Cloud Gateway、Zuul 等主流的 API Gateway 进行限流。</p>
<h3>Spring Cloud Gateway</h3>
<p>从 1.6.0 版本开始，Sentinel 提供了 Spring Cloud Gateway 的适配模块，可以提供两种资源维度的限流：</p>
<ul>
<li>route 维度：即在 Spring 配置文件中配置的路由条目，资源名为对应的 routeId</li>
<li>自定义 API 维度：用户可以利用 Sentinel 提供的 API 来自定义一些 API 分组</li>
</ul>
<p>使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-spring-cloud-gateway-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>使用时只需注入对应的 <code>SentinelGatewayFilter</code> 实例以及 <code>SentinelGatewayBlockExceptionHandler</code> 实例即可。比如：</p>
<pre><code class="language-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GatewayConfiguration</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;ViewResolver&gt; viewResolvers;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ServerCodecConfigurer serverCodecConfigurer;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GatewayConfiguration</span><span class="hljs-params">(ObjectProvider&lt;List&lt;ViewResolver&gt;&gt; viewResolversProvider,
                                ServerCodecConfigurer serverCodecConfigurer)</span> </span>{
        <span class="hljs-keyword">this</span>.viewResolvers = viewResolversProvider.getIfAvailable(Collections::emptyList);
        <span class="hljs-keyword">this</span>.serverCodecConfigurer = serverCodecConfigurer;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Order</span>(Ordered.HIGHEST_PRECEDENCE)
    <span class="hljs-function"><span class="hljs-keyword">public</span> SentinelGatewayBlockExceptionHandler <span class="hljs-title">sentinelGatewayBlockExceptionHandler</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// Register the block exception handler for Spring Cloud Gateway.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SentinelGatewayBlockExceptionHandler(viewResolvers, serverCodecConfigurer);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Order</span>(-<span class="hljs-number">1</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> GlobalFilter <span class="hljs-title">sentinelGatewayFilter</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SentinelGatewayFilter();
    }
}
</code></pre>
<p>Demo 示例：<a href="https://github.com/alibaba/Sentinel/tree/master/sentinel-demo/sentinel-demo-spring-cloud-gateway">sentinel-demo-spring-cloud-gateway</a></p>
<p>详细文档可以参考 <a href="https://github.com/alibaba/Sentinel/wiki/%E7%BD%91%E5%85%B3%E9%99%90%E6%B5%81#spring-cloud-gateway">网关限流 - Spring Cloud Gateway 文档</a>。</p>
<h2>Zuul 1.x</h2>
<p>Sentinel 提供了 Zuul 1.x 的适配模块，可以为 Zuul Gateway 提供两种资源维度的限流：</p>
<ul>
<li>route 维度：即在 Spring 配置文件中配置的路由条目，资源名为对应的 route ID（对应 <code>RequestContext</code> 中的 <code>proxy</code> 字段）</li>
<li>自定义 API 维度：用户可以利用 Sentinel 提供的 API 来自定义一些 API 分组</li>
</ul>
<p>使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-zuul-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>详细文档可以参考 <a href="https://github.com/alibaba/Sentinel/wiki/%E7%BD%91%E5%85%B3%E9%99%90%E6%B5%81#zuul-1x">网关限流 - Zuul 1.x</a>。</p>
<p>如果您正在使用 Spring Cloud Zuul Starter，那么可以通过引入 <code>spring-cloud-alibaba-sentinel-zuul</code> 来更方便地整合 Sentinel。请参考 <a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba/tree/master/spring-cloud-alibaba-sentinel-zuul">对应文档</a>。</p>
<h2>Zuul 2.x</h2>
<blockquote>
<p>注：从 1.7.2 版本开始支持，需要 Java 8 及以上版本。</p>
</blockquote>
<p>Sentinel 提供了 Zuul 2.x 的适配模块，可以为 Zuul Gateway 提供两种资源维度的限流：</p>
<ul>
<li>route 维度：对应 SessionContext 中的 <code>routeVIP</code></li>
<li>自定义 API 维度：用户可以利用 Sentinel 提供的 API 来自定义一些 API 分组</li>
</ul>
<p>使用时需引入以下模块（以 Maven 为例）：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.csp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sentinel-zuul2-adapter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>x.y.z<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>详细文档可以参考 <a href="https://github.com/alibaba/Sentinel/wiki/%E7%BD%91%E5%85%B3%E9%99%90%E6%B5%81#zuul-2x">网关限流 - Zuul 2.x</a>。</p>
<h2>Apache RocketMQ</h2>
<p>在 Apache RocketMQ 中，当消费者去消费消息的时候，无论是通过 pull 的方式还是 push 的方式，都可能会出现大批量的消息突刺。如果此时要处理所有消息，很可能会导致系统负载过高，影响稳定性。但其实可能后面几秒之内都没有消息投递，若直接把多余的消息丢掉则没有充分利用系统处理消息的能力。我们希望可以把消息突刺均摊到一段时间内，让系统负载保持在消息处理水位之下的同时尽可能地处理更多消息，从而起到“削峰填谷”的效果：</p>
<p><img src="https://github.com/alibaba/Sentinel/wiki/image/mq-traffic-peak-clipping.png" alt="削峰填谷"></p>
<p>上图中红色的部分代表超出消息处理能力的部分。我们可以看到消息突刺往往都是瞬时的、不规律的，其后一段时间系统往往都会有空闲资源。我们希望把红色的那部分消息平摊到后面空闲时去处理，这样既可以保证系统负载处在一个稳定的水位，又可以尽可能地处理更多消息。Sentinel 专门为这种场景提供了<a href="https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%8C%80%E9%80%9F%E5%99%A8">匀速器</a>的特性，可以把突然到来的大量请求以匀速的形式均摊，以固定的间隔时间让请求通过，以稳定的速度逐步处理这些请求，起到“削峰填谷”的效果，从而避免流量突刺造成系统负载过高。同时堆积的请求将会排队，逐步进行处理；当请求排队预计超过最大超时时长的时候则直接拒绝，而不是拒绝全部请求。</p>
<p>比如在 RocketMQ 的场景下配置了匀速模式下请求 QPS 为 5，则会每 200 ms 处理一条消息，多余的处理任务将排队；同时设置了超时时间为 5 s，预计排队时长超过 5 s 的处理任务将会直接被拒绝。示意图如下图所示：</p>
<p><img src="https://github.com/alibaba/Sentinel/wiki/image/uniform-speed-queue.png" alt="Uniform rate"></p>
<p>RocketMQ 用户可以根据不同的 group 和不同的 topic 分别设置限流规则，限流控制模式设置为匀速器模式（<code>RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER</code>），比如：</p>
<pre><code class="language-java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initFlowControlRule</span><span class="hljs-params">()</span> </span>{
    FlowRule rule = <span class="hljs-keyword">new</span> FlowRule();
    rule.setResource(KEY); <span class="hljs-comment">// 对应的 key 为 `groupName:topicName`</span>
    rule.setCount(<span class="hljs-number">5</span>);
    rule.setGrade(RuleConstant.FLOW_GRADE_QPS);
    rule.setLimitApp(<span class="hljs-string">"default"</span>);

    <span class="hljs-comment">// 匀速器模式下，设置了 QPS 为 5，则请求每 200 ms 允许通过 1 个</span>
    rule.setControlBehavior(RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER);
    <span class="hljs-comment">// 如果更多的请求到达，这些请求会被置于虚拟的等待队列中。等待队列有一个 max timeout，如果请求预计的等待时间超过这个时间会直接被 block</span>
    <span class="hljs-comment">// 在这里，timeout 为 5s</span>
    rule.setMaxQueueingTimeMs(<span class="hljs-number">5</span> * <span class="hljs-number">1000</span>);
    FlowRuleManager.loadRules(Collections.singletonList(rule));
}
</code></pre>
<p>结合 RocketMQ Client 使用 Sentinel 时，用户需要在处理消息时手动埋点。详情请见 <a href="https://github.com/alibaba/Sentinel/tree/master/sentinel-demo/sentinel-demo-rocketmq">Sentinel RocketMQ Demo</a>。相关 Blog 见 <a href="https://github.com/alibaba/Sentinel/wiki/Sentinel-%E4%B8%BA-RocketMQ-%E4%BF%9D%E9%A9%BE%E6%8A%A4%E8%88%AA">Sentinel 为 RocketMQ 保驾护航</a>。</p>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/sentinel_gray.png"/><div class="cols-container"><div class="col col-12"><h3>Disclaimer</h3><p>Sentinel is an open-source project under Apache License 2.0.</p></div><div class="col col-6"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/introduction.html" target="_self">概览</a></dd><dd><a href="/zh-cn/docs/quick-start.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/contribution/contribution-guideline.html" target="_self">开发者指南</a></dd></dl></div><div class="col col-6"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd><dd><a href="/zh-cn/community/index.html" target="_self">社区</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2018 - 2022 The Sentinel Authors | An Alibaba Middleware (Aliware) Project</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>